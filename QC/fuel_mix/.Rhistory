load("C:/Users/atyho/Dropbox/eletricity_data/QC/HydroQC.RData")
load("C:/Users/atyho/Dropbox/eletricity_data/QC/fuelmix_HydroQC.RData")
source("C:/Users/atyho/Dropbox/eletricity_data/QC/QC_data_process.R")
View(HydroQC)
library(dlm)
install.packages("dlm")
library(dlm)
set.seed(220606)
# Define the trend component (random walk)
mod_trend <- dlmModPoly(order = 1, dV = 1, dW = 1)
# Define the seasonal component with 24 periods (hours)
mod_seasonal <- dlmModSeas(frequency = 24, dV = 0)
# Combine the trend and seasonal components into one state-space model
mod <- mod_trend + mod_seasonal
# Apply the Kalman filter to the seasonal time series
filtered <- dlmFilter(HydroQC$load_QC, mod)
View(filtered)
# Apply Kalman smoothing to improve estimates, including missing values
smoothed <- dlmSmooth(filtered)
View(smoothed)
# Extract the smoothed values
smoothed_values <- dropFirst(smoothed$s)  # Drop initial state
View(smoothed_values)
View(smoothed)
View(filtered)
# Fill missing values in the original series
y_filled <- HydroQC$load_QC
y_filled[is.na(HydroQC$load_QC)] <- smoothed_values[is.na(HydroQC$load_QC), 1]  # The first component corresponds to the smoothed series
# Plot the original and filled series
plot(y_filled, type = "o", main = "Seasonal Time Series with Missing Data Filled")
lines(y, col = "red", lty = 2)  # Overlay original data with missing values (for comparison)
lines(HydroQC$load_QC, col = "red", lty = 2)  # Overlay original data with missing values (for comparison)
HydroQC$filled <- y_filled
View(HydroQC)
source("C:/Users/atyho/Dropbox/eletricity_data/QC/QC_data_process.R")
